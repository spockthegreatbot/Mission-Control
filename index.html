<!DOCTYPE html>
<html lang="en">
<head>
<meta name="robots" content="noindex, nofollow, noarchive, nosnippet">
<meta name="googlebot" content="noindex, nofollow">
<meta http-equiv="X-Robots-Tag" content="noindex, nofollow">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mission Control - Ryojin Dev</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Comprehensive business intelligence dashboard for tracking projects, revenue, agents, and operations">
    <meta name="theme-color" content="#6C63FF">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Mission Control">
    <meta name="msapplication-TileColor" content="#6C63FF">
    <meta name="msapplication-tap-highlight" content="no">
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* CSS Variables for theming */
        :root {
            --bg-primary: #050508;
            --bg-secondary: #08080c;
            --accent-color: #6C63FF;
            --border-color: rgba(255, 255, 255, 0.06);
            --border-hover: rgba(255, 255, 255, 0.12);
            --glass-bg: rgba(255, 255, 255, 0.05);
            --glass-bg-hover: rgba(255, 255, 255, 0.08);
            --text-primary: #ffffff;
            --text-secondary: #cccccc;
            --text-muted: #999999;
            --success-color: #00ff88;
            --warning-color: #ffb800;
            --error-color: #ff4444;
            --spacing-xs: 0.25rem;
            --spacing-sm: 0.5rem;
            --spacing-md: 1rem;
            --spacing-lg: 1.5rem;
            --spacing-xl: 2rem;
            --border-radius-sm: 4px;
            --border-radius-md: 8px;
            --border-radius-lg: 12px;
            --border-radius-xl: 16px;
            --transition: all 0.2s ease;
            --transition-slow: all 0.3s ease;
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 8px rgba(0, 0, 0, 0.15);
            --shadow-lg: 0 8px 16px rgba(0, 0, 0, 0.2);
        }

        /* Light theme variables */
        [data-theme="light"] {
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --accent-color: #6C63FF;
            --border-color: rgba(0, 0, 0, 0.1);
            --border-hover: rgba(0, 0, 0, 0.2);
            --glass-bg: rgba(0, 0, 0, 0.03);
            --glass-bg-hover: rgba(0, 0, 0, 0.05);
            --text-primary: #1a1a1a;
            --text-secondary: #4a5568;
            --text-muted: #718096;
            --success-color: #38a169;
            --warning-color: #d69e2e;
            --error-color: #e53e3e;
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 8px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 8px 16px rgba(0, 0, 0, 0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            transition: background 0.3s ease, color 0.3s ease;
        }

        /* Header Styles */
        .header {
            position: sticky;
            top: 0;
            z-index: 1000;
            background: rgba(8, 8, 12, 0.8);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border-color);
            padding: var(--spacing-md) var(--spacing-xl);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: var(--spacing-xl);
        }

        [data-theme="light"] .header {
            background: rgba(248, 249, 250, 0.8);
        }

        .logo {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--accent-color);
            text-decoration: none;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .logo:hover {
            transform: translateY(-1px);
        }

        .nav-tabs {
            display: flex;
            gap: var(--spacing-sm);
            flex: 1;
            justify-content: center;
            flex-wrap: wrap;
        }

        .nav-tab {
            padding: var(--spacing-sm) var(--spacing-md);
            background: var(--glass-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-md);
            color: var(--text-primary);
            text-decoration: none;
            font-size: 0.875rem;
            font-weight: 500;
            transition: var(--transition);
            cursor: pointer;
            white-space: nowrap;
        }

        .nav-tab:hover {
            background: var(--glass-bg-hover);
            border-color: var(--border-hover);
            transform: translateY(-1px);
        }

        .nav-tab.active {
            background: rgba(108, 99, 255, 0.2);
            border-color: var(--accent-color);
            color: var(--accent-color);
            box-shadow: 0 0 20px rgba(108, 99, 255, 0.3);
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .weather-info {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            padding: var(--spacing-sm) var(--spacing-md);
            background: var(--glass-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-md);
            font-size: 0.875rem;
            transition: var(--transition);
        }

        .weather-info:hover {
            background: var(--glass-bg-hover);
        }

        .server-status {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            transition: var(--transition);
        }

        .status-dot.online {
            background: var(--success-color);
            animation: pulse 2s infinite;
        }

        .status-dot.offline {
            background: var(--error-color);
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .theme-toggle {
            padding: var(--spacing-sm);
            background: var(--glass-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-md);
            cursor: pointer;
            transition: var(--transition);
            font-size: 1rem;
            color: var(--text-primary);
        }

        .theme-toggle:hover {
            background: var(--glass-bg-hover);
            transform: translateY(-1px);
        }

        /* Main Content */
        .main-content {
            max-width: 1600px;
            margin: 0 auto;
            padding: var(--spacing-xl);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeInUp 0.3s ease;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Card Styles */
        .card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-xl);
            padding: var(--spacing-lg);
            transition: var(--transition-slow);
            box-shadow: var(--shadow-sm);
        }

        .card:hover {
            background: var(--glass-bg-hover);
            border-color: var(--border-hover);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .card.accent-top {
            border-top: 3px solid var(--accent-color);
        }

        /* Grid Layouts */
        .grid-2 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--spacing-lg);
        }

        .grid-3 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--spacing-lg);
        }

        .grid-4 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--spacing-lg);
        }

        /* Button Styles */
        .btn {
            background: var(--accent-color);
            color: white;
            border: none;
            padding: 0.75rem var(--spacing-lg);
            border-radius: var(--border-radius-md);
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            transition: var(--transition);
            text-decoration: none;
            display: inline-block;
            text-align: center;
            font-family: inherit;
        }

        .btn:hover {
            background: #5a52e0;
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn-secondary {
            background: var(--glass-bg);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: var(--glass-bg-hover);
            border-color: var(--border-hover);
        }

        /* Form Styles */
        .form-group {
            margin-bottom: var(--spacing-md);
        }

        .form-label {
            display: block;
            margin-bottom: var(--spacing-sm);
            font-weight: 500;
            color: var(--text-secondary);
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            background: var(--glass-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-md);
            padding: 0.75rem var(--spacing-md);
            color: var(--text-primary);
            font-size: 0.875rem;
            font-family: inherit;
            transition: var(--transition);
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--accent-color);
            background: var(--glass-bg-hover);
            box-shadow: 0 0 0 3px rgba(108, 99, 255, 0.1);
        }

        /* Dashboard Specific */
        .welcome-bar {
            background: rgba(108, 99, 255, 0.1);
            border: 1px solid rgba(108, 99, 255, 0.3);
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-xl);
            text-align: center;
            transition: var(--transition-slow);
        }

        .welcome-bar:hover {
            background: rgba(108, 99, 255, 0.15);
        }

        .welcome-text {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: var(--spacing-sm);
        }

        .metric-card {
            text-align: center;
            position: relative;
            cursor: pointer;
        }

        .metric-card:hover .metric-icon {
            transform: scale(1.1);
        }

        .metric-icon {
            font-size: 2rem;
            margin-bottom: var(--spacing-md);
            transition: var(--transition);
        }

        .metric-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: var(--spacing-sm);
        }

        .metric-label {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .trend-indicator {
            position: absolute;
            top: var(--spacing-md);
            right: var(--spacing-md);
            font-size: 0.75rem;
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--border-radius-sm);
            background: rgba(0, 255, 136, 0.2);
            color: var(--success-color);
        }

        /* Live Activity Feed */
        .activity-feed {
            max-height: 400px;
            overflow-y: auto;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-md);
            padding: var(--spacing-sm);
            font-family: 'Courier New', monospace;
        }

        .activity-entry {
            padding: var(--spacing-xs) 0;
            border-bottom: 1px solid var(--border-color);
            font-size: 0.8rem;
            line-height: 1.4;
        }

        .activity-entry:last-child {
            border-bottom: none;
        }

        .activity-timestamp {
            color: var(--text-muted);
            margin-right: var(--spacing-sm);
        }

        .activity-level {
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.7rem;
            margin-right: var(--spacing-sm);
        }

        .activity-level.info { background: rgba(108, 99, 255, 0.2); color: var(--accent-color); }
        .activity-level.warn { background: rgba(255, 184, 0, 0.2); color: var(--warning-color); }
        .activity-level.error { background: rgba(255, 68, 68, 0.2); color: var(--error-color); }

        /* Cost Tracker */
        .cost-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-lg);
        }

        .cost-stat {
            text-align: center;
            padding: var(--spacing-md);
            background: var(--glass-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-lg);
        }

        .cost-value {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--accent-color);
            margin-bottom: var(--spacing-xs);
        }

        .cost-label {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        /* Agent Cards */
        .agent-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-xl);
        }

        .agent-card {
            background: var(--glass-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-xl);
            padding: var(--spacing-lg);
            cursor: pointer;
            transition: var(--transition-slow);
        }

        .agent-card:hover {
            background: var(--glass-bg-hover);
            border-color: var(--border-hover);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .agent-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--spacing-md);
        }

        .agent-info h3 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: var(--spacing-xs);
        }

        .agent-role {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .agent-status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-top: var(--spacing-xs);
        }

        .status-online {
            background: var(--success-color);
            animation: pulse 2s infinite;
        }

        .status-idle {
            background: var(--warning-color);
        }

        .status-offline {
            background: #666666;
        }

        .agent-model {
            background: rgba(108, 99, 255, 0.2);
            color: var(--accent-color);
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--border-radius-sm);
            font-size: 0.75rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
            display: inline-block;
        }

        .agent-last-active {
            color: var(--text-muted);
            font-size: 0.75rem;
        }

        /* Agent Detail Slide-out */
        .agent-detail-panel {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100vh;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-left: 1px solid var(--border-color);
            z-index: 2000;
            transition: right 0.3s ease;
            overflow-y: auto;
            padding: var(--spacing-lg);
        }

        .agent-detail-panel.open {
            right: 0;
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-lg);
            padding-bottom: var(--spacing-md);
            border-bottom: 1px solid var(--border-color);
        }

        .panel-close {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 1.5rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .panel-close:hover {
            color: var(--text-primary);
        }

        .session-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .session-item {
            padding: var(--spacing-sm);
            background: var(--glass-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-md);
            margin-bottom: var(--spacing-sm);
        }

        .session-key {
            font-weight: 600;
            color: var(--accent-color);
            font-size: 0.875rem;
        }

        .session-meta {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: var(--spacing-xs);
        }

        /* Chat Panel */
        .chat-mini-panel {
            background: var(--glass-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-lg);
        }

        .chat-messages {
            max-height: 200px;
            overflow-y: auto;
            margin-bottom: var(--spacing-md);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-md);
            padding: var(--spacing-sm);
            background: var(--bg-primary);
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
        }

        .chat-message {
            padding: var(--spacing-xs) 0;
            border-bottom: 1px solid var(--border-color);
            line-height: 1.4;
        }

        .chat-message:last-child {
            border-bottom: none;
        }

        .chat-input-group {
            display: flex;
            gap: var(--spacing-sm);
        }

        .chat-input {
            flex: 1;
            padding: var(--spacing-sm);
            background: var(--glass-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-md);
            color: var(--text-primary);
            font-size: 0.875rem;
        }

        /* Utility Classes */
        .text-center { text-align: center; }
        .mb-1 { margin-bottom: var(--spacing-sm); }
        .mb-2 { margin-bottom: var(--spacing-md); }
        .mb-3 { margin-bottom: var(--spacing-lg); }
        .flex { display: flex; }
        .justify-between { justify-content: space-between; }
        .items-center { align-items: center; }
        .gap-2 { gap: var(--spacing-md); }
        .w-100 { width: 100%; }
        .hidden { display: none; }

        /* Responsive */
        @media (max-width: 768px) {
            .header {
                padding: var(--spacing-md);
                flex-wrap: wrap;
            }

            .nav-tabs {
                order: 3;
                width: 100%;
                justify-content: flex-start;
                overflow-x: auto;
                padding-top: var(--spacing-md);
            }

            .main-content {
                padding: var(--spacing-md);
            }

            .grid-4 {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }

            .agent-grid {
                grid-template-columns: 1fr;
            }

            .agent-detail-panel {
                width: 100vw;
                right: -100vw;
            }
        }
    </style>
</head>
<body>
    <!-- Auth Gate -->
    <div id="authGate" style="position:fixed;inset:0;z-index:99999;background:#050508;display:flex;align-items:center;justify-content:center;font-family:'Inter',sans-serif;">
        <div style="background:rgba(255,255,255,0.03);backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,0.06);border-radius:16px;padding:3rem;width:100%;max-width:400px;animation:fadeInUp .5s ease;">
            <div style="text-align:center;font-size:2rem;margin-bottom:1.5rem;">üöÄ</div>
            <h1 style="font-size:1.5rem;font-weight:600;margin-bottom:.5rem;text-align:center;color:#fff;">Mission Control</h1>
            <p style="color:rgba(255,255,255,0.4);font-size:.85rem;text-align:center;margin-bottom:2rem;">Enter credentials to continue</p>
            <form id="authForm">
                <label style="display:block;font-size:.8rem;color:rgba(255,255,255,0.5);margin-bottom:.4rem;">Username</label>
                <input type="text" id="authUser" autocomplete="username" required autofocus style="width:100%;padding:.75rem 1rem;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:#fff;font-size:.9rem;font-family:inherit;outline:none;margin-bottom:1rem;">
                <label style="display:block;font-size:.8rem;color:rgba(255,255,255,0.5);margin-bottom:.4rem;">Password</label>
                <input type="password" id="authPass" autocomplete="current-password" required style="width:100%;padding:.75rem 1rem;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:#fff;font-size:.9rem;font-family:inherit;outline:none;">
                <button type="submit" id="authBtn" style="width:100%;padding:.75rem;background:#6C63FF;color:#fff;border:none;border-radius:8px;font-size:.95rem;font-weight:600;font-family:inherit;cursor:pointer;margin-top:1.5rem;">Sign In</button>
                <div id="authError" style="color:#ff4757;font-size:.8rem;text-align:center;margin-top:1rem;display:none;">Invalid credentials</div>
            </form>
        </div>
    </div>
    <div id="appContent" style="display:none;">

    <header class="header">
        <a href="#" class="logo">
            üöÄ Mission Control
            <span id="offlineIndicator" class="hidden" style="font-size: 0.75rem; color: var(--warning-color);">üì° Offline</span>
        </a>
        <nav class="nav-tabs">
            <a href="#" class="nav-tab active" data-tab="dashboard" onclick="event.preventDefault();switchTab('dashboard')">üìä Dashboard</a>
            <a href="#" class="nav-tab" data-tab="projects" onclick="event.preventDefault();switchTab('projects')">üìã Projects</a>
            <a href="#" class="nav-tab" data-tab="timeline" onclick="event.preventDefault();switchTab('timeline')">üìÖ Timeline</a>
            <a href="#" class="nav-tab" data-tab="notes" onclick="event.preventDefault();switchTab('notes')">üìù Notes</a>
            <a href="#" class="nav-tab" data-tab="revenue" onclick="event.preventDefault();switchTab('revenue')">üí∞ Revenue</a>
            <a href="#" class="nav-tab" data-tab="command-center" onclick="event.preventDefault();switchTab('command-center')">üè¢ Command Center</a>
        </nav>
        <div class="header-right">
            <div class="weather-info" id="weatherInfo">
                <span>üå§Ô∏è Loading...</span>
            </div>
            <div class="server-status">
                <div class="status-dot offline" id="statusDot"></div>
                <span id="serverStatus">Server: Offline</span>
            </div>
            <div class="header-actions">
                <button class="theme-toggle" onclick="toggleTheme()" id="themeToggle">üåô</button>
            </div>
        </div>
    </header>

    <main class="main-content">
        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="welcome-bar">
                <div class="welcome-text" id="welcomeText">Good morning, Tolga</div>
                <div class="welcome-date" id="welcomeDate"></div>
            </div>

            <!-- Cost Overview Widget -->
            <div class="card">
                <div class="flex justify-between items-center mb-2">
                    <h3>üí∞ Cost Overview</h3>
                    <button class="btn-secondary" onclick="refreshCosts()">Refresh</button>
                </div>
                <div class="cost-overview" id="costOverview">
                    <div class="cost-stat">
                        <div class="cost-value" id="totalCostToday">$0.00</div>
                        <div class="cost-label">Today's Cost</div>
                    </div>
                    <div class="cost-stat">
                        <div class="cost-value" id="totalTokensToday">0</div>
                        <div class="cost-label">Total Tokens</div>
                    </div>
                    <div class="cost-stat">
                        <div class="cost-value" id="activeAgents">0</div>
                        <div class="cost-label">Active Agents</div>
                    </div>
                    <div class="cost-stat">
                        <div class="cost-value" id="estimatedMonthly">$0.00</div>
                        <div class="cost-label">Est. Monthly</div>
                    </div>
                </div>
                <div id="agentCostBreakdown" class="mb-2">
                    <!-- Agent cost breakdown will be loaded here -->
                </div>
            </div>

            <!-- Live Activity Feed -->
            <div class="card">
                <div class="flex justify-between items-center mb-2">
                    <h3>üìä Live Activity Feed</h3>
                    <button class="btn-secondary" onclick="refreshActivityFeed()">Refresh</button>
                </div>
                <div class="activity-feed" id="liveActivityFeed">
                    <div class="activity-entry">
                        <span class="activity-timestamp">Loading...</span>
                        <span>Connecting to OpenClaw gateway...</span>
                    </div>
                </div>
            </div>

            <!-- Dashboard Metric Cards -->
            <div class="grid-4 mb-3">
                <div class="card accent-top metric-card">
                    <div class="metric-icon">üí∞</div>
                    <div class="metric-value" id="metric0Value">$0</div>
                    <div class="metric-label">MRR Progress ($10K Goal)</div>
                    <div class="trend-indicator">+0%</div>
                </div>
                <div class="card accent-top metric-card">
                    <div class="metric-icon">üë•</div>
                    <div class="metric-value" id="metric1Value">0</div>
                    <div class="metric-label">Active Clients</div>
                    <div class="trend-indicator">+0</div>
                </div>
                <div class="card accent-top metric-card">
                    <div class="metric-icon">üêõ</div>
                    <div class="metric-value" id="metric2Value">0</div>
                    <div class="metric-label">Open Issues</div>
                    <div class="trend-indicator">+0</div>
                </div>
                <div class="card accent-top metric-card">
                    <div class="metric-icon">ü§ñ</div>
                    <div class="metric-value" id="metric3Value">0</div>
                    <div class="metric-label">Agent Tasks</div>
                    <div class="trend-indicator">‚è∞</div>
                </div>
            </div>
        </div>

        <!-- Projects Tab -->
        <div id="projects" class="tab-content">
            <p>Project management features go here...</p>
        </div>

        <!-- Timeline Tab -->
        <div id="timeline" class="tab-content">
            <p>Timeline features go here...</p>
        </div>

        <!-- Notes Tab -->
        <div id="notes" class="tab-content">
            <div class="card">
                <textarea class="form-textarea" id="notesEditor" placeholder="Write your notes here..." style="min-height: 500px;"></textarea>
                <div class="flex justify-between items-center" style="margin-top: 1rem; font-size: 0.875rem; color: var(--text-muted);">
                    <span id="charCount">0 characters</span>
                    <span id="lastSaved">Never saved</span>
                </div>
            </div>
        </div>

        <!-- Revenue Tab -->
        <div id="revenue" class="tab-content">
            <p>Revenue tracking features go here...</p>
        </div>

        <!-- Command Center Tab -->
        <div id="command-center" class="tab-content">
            <h3 class="mb-2" style="color:var(--text-primary);font-size:1.1rem;">üè¢ Agent Overview</h3>
            <div class="agent-grid" id="agentGrid">
                <!-- Agent cards auto-populated from OpenClaw -->
            </div>
        </div>
    </main>

    <!-- Agent Detail Panel -->
    <div id="agentDetailPanel" class="agent-detail-panel">
        <div class="panel-header">
            <h3 id="agentDetailName">Agent Details</h3>
            <button class="panel-close" onclick="closeAgentDetail()">&times;</button>
        </div>
        
        <div id="agentDetailContent">
            <div class="mb-2">
                <strong>Role:</strong> <span id="agentDetailRole">Unknown</span>
            </div>
            <div class="mb-2">
                <strong>Model:</strong> <span id="agentDetailModel">Unknown</span>
            </div>
            <div class="mb-2">
                <strong>Status:</strong> <span id="agentDetailStatus">Unknown</span>
            </div>
            <div class="mb-2">
                <strong>Last Active:</strong> <span id="agentDetailLastActive">Unknown</span>
            </div>
            
            <h4 style="margin: 1.5rem 0 1rem 0;">Recent Sessions</h4>
            <div class="session-list" id="agentSessionList">
                <p style="color: var(--text-muted);">Loading sessions...</p>
            </div>
            
            <div style="margin-top: 1.5rem;">
                <button class="btn w-100" onclick="refreshAgentSessions()">Refresh Sessions</button>
            </div>
        </div>
    </div>

    <script>
        // Global Variables
        let currentTab = 'dashboard';
        let serverConnected = false;
        let currentAgentDetail = null;
        let activityFeedInterval = null;
        let costsRefreshInterval = null;

        // Server API base URL
        const IS_LOCAL = window.location.hostname === 'localhost' || window.location.hostname === '45.76.125.57';
        const SERVER_URL = IS_LOCAL ? '' : '';
        
        // Auth helper
        function getAuthHeaders() {
            const token = localStorage.getItem('mc_token');
            return token ? { 'Authorization': 'Bearer ' + token } : {};
        }

        function authFetch(url, opts = {}) {
            opts.headers = { ...getAuthHeaders(), ...(opts.headers || {}) };
            return fetch(url, opts).then(r => {
                if (r.status === 401 && IS_LOCAL) { 
                    localStorage.removeItem('mc_token'); 
                    window.location.href = '/login'; 
                }
                return r;
            });
        }

        // Initialize App
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is already authenticated
            const token = localStorage.getItem('mc_token');
            if (token) {
                authFetch('/auth/check')
                    .then(r => r.json())
                    .then(data => {
                        if (data.authenticated) {
                            unlockApp();
                        } else {
                            showAuthGate();
                        }
                    })
                    .catch(() => showAuthGate());
            } else {
                showAuthGate();
            }
        });

        function showAuthGate() {
            document.getElementById('authGate').style.display = 'flex';
            document.getElementById('appContent').style.display = 'none';
            
            // Setup auth form
            document.getElementById('authForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                const btn = document.getElementById('authBtn');
                const error = document.getElementById('authError');
                
                btn.disabled = true;
                btn.textContent = 'Signing in...';
                error.style.display = 'none';
                
                try {
                    const response = await fetch('/auth/login', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            username: document.getElementById('authUser').value,
                            password: document.getElementById('authPass').value
                        })
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        localStorage.setItem('mc_token', data.token);
                        unlockApp();
                    } else {
                        error.style.display = 'block';
                        btn.disabled = false;
                        btn.textContent = 'Sign In';
                    }
                } catch (err) {
                    error.textContent = 'Connection error';
                    error.style.display = 'block';
                    btn.disabled = false;
                    btn.textContent = 'Sign In';
                }
            });
        }

        function unlockApp() {
            document.getElementById('authGate').style.display = 'none';
            document.getElementById('appContent').style.display = 'block';
            initializeApp();
        }

        async function initializeApp() {
            // Initialize theme
            initializeTheme();
            
            // Update date/time
            updateDateTime();
            setInterval(updateDateTime, 60000);
            
            // Initialize server connection
            await checkServerConnection();
            
            // Setup periodic updates
            setInterval(checkServerConnection, 60000);
            
            // Load agent data
            loadAgents();
            
            // Setup activity feed auto-refresh (every 30 seconds)
            refreshActivityFeed();
            activityFeedInterval = setInterval(refreshActivityFeed, 30000);
            
            // Setup cost tracking auto-refresh (every 2 minutes)
            refreshCosts();
            costsRefreshInterval = setInterval(refreshCosts, 120000);
            
            // Setup notes auto-save
            const notesEditor = document.getElementById('notesEditor');
            if (notesEditor) {
                notesEditor.addEventListener('input', updateNotesStats);
                loadNotes();
            }
        }

        // Theme Functions
        function initializeTheme() {
            const savedTheme = localStorage.getItem('theme') || 'dark';
            setTheme(savedTheme);
        }

        function toggleTheme() {
            const currentTheme = document.documentElement.dataset.theme || 'dark';
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            setTheme(newTheme);
        }

        function setTheme(theme) {
            document.documentElement.dataset.theme = theme;
            localStorage.setItem('theme', theme);
            
            const themeToggle = document.getElementById('themeToggle');
            if (themeToggle) {
                themeToggle.textContent = theme === 'dark' ? 'üåû' : 'üåô';
            }
        }

        // Server Connection Functions
        async function checkServerConnection() {
            try {
                const response = await authFetch(`${SERVER_URL}/mc/status`);
                const data = await response.json();
                
                if (data.health === 'online') {
                    serverConnected = true;
                    updateServerStatus(true);
                    loadWeatherData();
                    updateIntegrationStatuses(data.features || {});
                } else {
                    throw new Error('Server not healthy');
                }
            } catch (error) {
                serverConnected = false;
                updateServerStatus(false);
                console.warn('Server connection failed:', error);
            }
        }

        function updateServerStatus(connected) {
            const statusDot = document.getElementById('statusDot');
            const serverStatus = document.getElementById('serverStatus');
            
            if (connected) {
                statusDot.className = 'status-dot online';
                serverStatus.textContent = 'Server: Online';
            } else {
                statusDot.className = 'status-dot offline';
                serverStatus.textContent = 'Server: Offline';
            }
        }

        function updateIntegrationStatuses(features) {
            const gatewayStatus = document.getElementById('gatewayStatus');
            
            if (gatewayStatus) {
                gatewayStatus.textContent = features.openclaw ? 'Connected' : 'Unavailable';
                gatewayStatus.style.color = features.openclaw ? 'var(--success-color)' : 'var(--error-color)';
            }
        }

        async function loadWeatherData() {
            if (!serverConnected) return;
            
            try {
                const response = await authFetch(`${SERVER_URL}/mc/weather?city=Gold+Coast`);
                const weather = await response.json();
                
                const weatherInfo = document.getElementById('weatherInfo');
                if (weather.temp && weather.condition) {
                    weatherInfo.innerHTML = `
                        <span>üå§Ô∏è ${weather.temp}¬∞C</span>
                        <span style="color: var(--text-muted); font-size: 0.75rem;">${weather.condition}</span>
                    `;
                } else {
                    weatherInfo.innerHTML = '<span>üå§Ô∏è Weather unavailable</span>';
                }
            } catch (error) {
                console.error('Error loading weather:', error);
                const weatherInfo = document.getElementById('weatherInfo');
                weatherInfo.innerHTML = '<span>üå§Ô∏è Weather offline</span>';
            }
        }

        // Tab Navigation
        function switchTab(tabName) {
            // Update nav tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            
            // Show/hide content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tabName).classList.add('active');
            
            currentTab = tabName;
        }

        // Date/Time Functions
        function updateDateTime() {
            const now = new Date();
            const hours = now.getHours();
            let greeting = 'Good morning';
            
            if (hours >= 12 && hours < 17) greeting = 'Good afternoon';
            else if (hours >= 17) greeting = 'Good evening';
            
            const welcomeText = document.getElementById('welcomeText');
            if (welcomeText) {
                welcomeText.textContent = `${greeting}, Tolga`;
            }
            
            const welcomeDate = document.getElementById('welcomeDate');
            if (welcomeDate) {
                welcomeDate.textContent = now.toLocaleDateString('en-US', { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });
            }
        }

        // CRITICAL FIX: Disable WebSocket connections
        // NO WebSocket setup function - this was causing the spam
        function setupWebSocket() {
            // DISABLED: WebSocket connections to OpenClaw gateway
            // This was causing constant handshake timeout errors
            console.log('WebSocket connections disabled to prevent spam');
            
            // Update status to show REST API mode
            const messages = document.getElementById('agentMessages');
            addChatMessage('system', 'Using REST API mode for agent communication');
            addChatMessage('system', 'WebSocket spam prevention: Direct gateway connections disabled');
        }

        // Agent Management Functions
        async function loadAgents() {
            try {
                const response = await authFetch(`${SERVER_URL}/mc/openclaw/agents`);
                const data = await response.json();
                
                renderAgents(data.agents || []);
                updateActiveAgentsCount(data.agents || []);
            } catch (error) {
                console.error('Error loading agents:', error);
                renderAgents([]);
            }
        }

        function renderAgents(agents) {
            const container = document.getElementById('agentGrid');
            if (!container) return;
            
            if (agents.length === 0) {
                container.innerHTML = '<div class="text-center" style="color: var(--text-muted); grid-column: 1/-1;">No agents available</div>';
                return;
            }
            
            container.innerHTML = agents.map(agent => `
                <div class="agent-card" onclick="showAgentDetail('${agent.id}')">
                    <div class="agent-header">
                        <div class="agent-info">
                            <h3>${agent.name}</h3>
                            <div class="agent-role">${agent.role}</div>
                        </div>
                        <div class="agent-status-dot status-${agent.status}"></div>
                    </div>
                    <div class="agent-model">${agent.model}</div>
                    <div class="agent-last-active">
                        ${agent.lastActive ? 
                            `Last active: ${formatTimeAgo(agent.lastActiveAgo)}` : 
                            'Never active'
                        }
                    </div>
                </div>
            `).join('');
        }

        function updateActiveAgentsCount(agents) {
            const activeCount = agents.filter(a => a.status === 'online').length;
            const element = document.getElementById('activeAgents');
            if (element) {
                element.textContent = activeCount;
            }
        }

        async function showAgentDetail(agentId) {
            try {
                // Get agent info
                const agentsResponse = await authFetch(`${SERVER_URL}/mc/openclaw/agents`);
                const agentsData = await agentsResponse.json();
                const agent = (agentsData.agents || []).find(a => a.id === agentId);
                
                if (!agent) {
                    console.error('Agent not found:', agentId);
                    return;
                }
                
                currentAgentDetail = agent;
                
                // Populate agent details
                document.getElementById('agentDetailName').textContent = agent.name;
                document.getElementById('agentDetailRole').textContent = agent.role;
                document.getElementById('agentDetailModel').textContent = agent.model;
                document.getElementById('agentDetailStatus').textContent = agent.status;
                document.getElementById('agentDetailLastActive').textContent = 
                    agent.lastActive ? formatTimeAgo(agent.lastActiveAgo) : 'Never active';
                
                // Load sessions
                await refreshAgentSessions();
                
                // Show panel
                document.getElementById('agentDetailPanel').classList.add('open');
            } catch (error) {
                console.error('Error loading agent details:', error);
            }
        }

        function closeAgentDetail() {
            document.getElementById('agentDetailPanel').classList.remove('open');
            currentAgentDetail = null;
        }

        async function refreshAgentSessions() {
            if (!currentAgentDetail) return;
            
            try {
                const response = await authFetch(`${SERVER_URL}/mc/openclaw/sessions`);
                const data = await response.json();
                
                // Filter sessions for current agent
                const agentSessions = (data.sessions || [])
                    .filter(s => s.agentId === currentAgentDetail.id)
                    .slice(0, 10); // Show only last 10
                
                const container = document.getElementById('agentSessionList');
                
                if (agentSessions.length === 0) {
                    container.innerHTML = '<p style="color: var(--text-muted);">No recent sessions found</p>';
                    return;
                }
                
                container.innerHTML = agentSessions.map(session => `
                    <div class="session-item">
                        <div class="session-key">${session.key}</div>
                        <div class="session-meta">
                            Model: ${session.model} | 
                            Tokens: ${session.tokens.total.toLocaleString()} | 
                            Updated: ${session.updatedAt ? formatTimeAgo(Date.now() - new Date(session.updatedAt).getTime()) : 'Unknown'}
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading sessions:', error);
                document.getElementById('agentSessionList').innerHTML = 
                    '<p style="color: var(--error-color);">Error loading sessions</p>';
            }
        }

        // Live Activity Feed
        async function refreshActivityFeed() {
            try {
                const response = await authFetch(`${SERVER_URL}/mc/openclaw/logs`);
                const data = await response.json();
                
                const container = document.getElementById('liveActivityFeed');
                const entries = data.entries || [];
                
                if (entries.length === 0) {
                    container.innerHTML = `
                        <div class="activity-entry">
                            <span class="activity-timestamp">${formatTime(new Date())}</span>
                            <span>No recent activity</span>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = entries.slice(0, 20).map(entry => `
                    <div class="activity-entry">
                        <span class="activity-timestamp">${formatTime(new Date(entry.timestamp))}</span>
                        <span class="activity-level ${entry.level}">${entry.level.toUpperCase()}</span>
                        <span>${entry.subsystem}: ${entry.message}</span>
                    </div>
                `).join('');
                
                // Auto-scroll to top
                container.scrollTop = 0;
            } catch (error) {
                console.error('Error refreshing activity feed:', error);
                const container = document.getElementById('liveActivityFeed');
                container.innerHTML = `
                    <div class="activity-entry">
                        <span class="activity-timestamp">${formatTime(new Date())}</span>
                        <span class="activity-level error">ERROR</span>
                        <span>Failed to load activity feed</span>
                    </div>
                `;
            }
        }

        // Cost Tracking
        async function refreshCosts() {
            try {
                const response = await authFetch(`${SERVER_URL}/mc/openclaw/costs`);
                const data = await response.json();
                
                // Update overview stats
                document.getElementById('totalCostToday').textContent = `$${data.today.estimatedCost}`;
                document.getElementById('totalTokensToday').textContent = data.today.totalTokens.toLocaleString();
                document.getElementById('estimatedMonthly').textContent = `$${(data.today.estimatedCost * 30).toFixed(2)}`;
                
                // Render agent breakdown
                const breakdownContainer = document.getElementById('agentCostBreakdown');
                if (data.agentBreakdown && data.agentBreakdown.length > 0) {
                    breakdownContainer.innerHTML = `
                        <h5 style="margin-bottom: 1rem;">Agent Breakdown</h5>
                        <div style="display: grid; gap: 0.5rem;">
                            ${data.agentBreakdown.map(agent => `
                                <div style="display: flex; justify-content: space-between; padding: 0.5rem; background: var(--glass-bg); border-radius: 6px;">
                                    <span>${agent.agentId}</span>
                                    <div>
                                        <span style="margin-right: 1rem;">${agent.totalTokens.toLocaleString()} tokens</span>
                                        <span style="color: var(--accent-color);">$${agent.cost.toFixed(3)}</span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                } else {
                    breakdownContainer.innerHTML = '<p style="color: var(--text-muted);">No activity today</p>';
                }
            } catch (error) {
                console.error('Error refreshing costs:', error);
                document.getElementById('totalCostToday').textContent = '$0.00';
                document.getElementById('totalTokensToday').textContent = '0';
                document.getElementById('estimatedMonthly').textContent = '$0.00';
                document.getElementById('agentCostBreakdown').innerHTML = 
                    '<p style="color: var(--error-color);">Error loading cost data</p>';
            }
        }

        // Chat Functions (REST API based)
        async function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            input.value = '';
            addChatMessage('user', message);
            
            try {
                const response = await authFetch(`${SERVER_URL}/mc/agent/task`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        task: message,
                        agent: 'general'
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    addChatMessage('system', result.message);
                } else {
                    addChatMessage('system', 'Failed to send task: ' + result.error);
                }
            } catch (error) {
                console.error('Error sending task:', error);
                addChatMessage('system', 'Connection error while sending task');
            }
        }

        function handleChatKeypress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendChatMessage();
            }
        }

        function addChatMessage(type, message) {
            const container = document.getElementById('agentMessages');
            const messageElement = document.createElement('div');
            messageElement.className = 'chat-message';
            messageElement.innerHTML = `<strong>${type.charAt(0).toUpperCase() + type.slice(1)}:</strong> ${message}`;
            
            container.appendChild(messageElement);
            container.scrollTop = container.scrollHeight;
            
            // Keep only last 50 messages
            while (container.children.length > 50) {
                container.removeChild(container.firstChild);
            }
        }

        // Notes Functions
        function updateNotesStats() {
            const editor = document.getElementById('notesEditor');
            const charCount = document.getElementById('charCount');
            const lastSaved = document.getElementById('lastSaved');
            
            if (editor && charCount) {
                charCount.textContent = `${editor.value.length} characters`;
            }
            
            // Auto-save (debounced)
            clearTimeout(window.notesTimeout);
            window.notesTimeout = setTimeout(saveNotes, 1000);
        }

        function saveNotes() {
            const editor = document.getElementById('notesEditor');
            const lastSaved = document.getElementById('lastSaved');
            
            if (editor) {
                localStorage.setItem('mc_notes', editor.value);
                if (lastSaved) {
                    lastSaved.textContent = `Saved at ${new Date().toLocaleTimeString()}`;
                }
            }
        }

        function loadNotes() {
            const editor = document.getElementById('notesEditor');
            if (editor) {
                const saved = localStorage.getItem('mc_notes') || '';
                editor.value = saved;
                updateNotesStats();
            }
        }

        // Utility Functions
        function formatTimeAgo(ms) {
            if (!ms || ms < 0) return 'Unknown';
            
            const seconds = Math.floor(ms / 1000);
            const minutes = Math.floor(seconds / 60);
            const hours = Math.floor(minutes / 60);
            const days = Math.floor(hours / 24);
            
            if (days > 0) return `${days}d ago`;
            if (hours > 0) return `${hours}h ago`;
            if (minutes > 0) return `${minutes}m ago`;
            return 'Just now';
        }

        function formatTime(date) {
            return date.toLocaleTimeString('en-US', { 
                hour12: false, 
                hour: '2-digit', 
                minute: '2-digit',
                second: '2-digit'
            });
        }

        // Initialize disabled WebSocket setup
        setupWebSocket();

        // Cleanup intervals when page unloads
        window.addEventListener('beforeunload', () => {
            if (activityFeedInterval) clearInterval(activityFeedInterval);
            if (costsRefreshInterval) clearInterval(costsRefreshInterval);
        });
    </script>

    </div>
</body>
</html>